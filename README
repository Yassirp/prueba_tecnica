## Microservicio Documentos

Este es un microservicio para la GestiÃ³n Documental de todos los proyectos de Naowee

## ğŸš€ ConfiguraciÃ³n del Proyecto

Version de Python requerida: Python 3.12.x

- Eliminar migraciones anteriores:

```bash
python3 src/app/command/delete_migrations.py
```

- Ejecutar docker compose:

```bash
docker compose up -d --build
```

## ğŸ§© Crear Base de Datos: master-documents docker exec -it micro_lvr_api bash

- Ejecutar migracion inicial:
  Es necesario ejecutar el comando desde el contenedor del
  api en el docker, sobre la carpeta src

```bash
alembic revision --autogenerate -m "initial migration"
```

- Aplicar cambios de la migracion en la DB:
  Es necesario ejecutar el comando desde el contenedor del
  api en el docker, sobre la carpeta src

```bash
alembic upgrade head
```

## ğŸš€ Iniciar proyecto sin docker

- Ejecutar proyecto en local:

```bash
uvicorn src.app.main:app --reload
```

- Ejecutar analisis de codigo:

```bash
./check_quality.sh
```

## ğŸ§© Migraciones con Alembic

- Crear migracion en DB:
  Genera un archivo de migraciÃ³n dentro del directorio alembic/versions/.

âœ… Alembic compara el modelo actual (definido en tus clases SQLAlchemy) con la estructura actual de la base de datos. Si encuentra diferencias (por ejemplo, una nueva clase Stage), genera SQL para crear la tabla correspondiente.

```bash
alembic revision --autogenerate -m "create NAME table"
```

    ## ğŸ“¦ Aplicar los cambios a la base de datos
    - Bajar cambios a la DB:
    Ejecuta todas las migraciones pendientes hasta la Ãºltima versiÃ³n (head).

    âœ… Aplica los cambios definidos (crear tablas, modificar columnas, etc).

    ğŸ“Œ Â¿CuÃ¡ndo se usa?
    DespuÃ©s de crear una migraciÃ³n con revision, debes aplicar los cambios a la base de     datos con upgrade.

    COMANDO A EJECUTAR:
    - alembic upgrade head

## ğŸ› ï¸ Agregar un nuevo campo a un modelo existente

- Nuevo campo a la DB: Detecta que agregaste un nuevo campo (por ejemplo, description = Column(String) en Stage) en tu modelo.

âœ… Genera una migraciÃ³n con una instrucciÃ³n ALTER TABLE para agregar esa columna.

```bash
alembic revision --autogenerate -m "add description column to stage"
```

    ## ğŸ“¦ Aplicar los cambios tras agregar una columna

    - âœ… Ejecuta el script de migraciÃ³n generado y aplica el ALTER TABLE a la base de   datos.

    COMANDO A EJECUTAR:
    - alembic upgrade head

## ğŸ“ Estructura generada para modulos

- Este comando ejecuta el script generate_module.py y crea automÃ¡ticamente la estructura de carpetas y archivos para un nuevo mÃ³dulo llamado vehicles, siguiendo una convenciÃ³n predefinida para proyectos modulares en Python (como FastAPI, Flask, etc.).

```bash
python3 src/app/command/generate_module.py vehicles
```

- ğŸ” Alternativa: Si python3 no funciona en tu entorno, prueba con:

```bash
python src/app/command/generate_module.py vehicles
```

## Ejecutar seeders

## correr dentro de docker docker exec -it micro_lvr_api bash

```bash

python3 src/app/command/db_seed.py
```
